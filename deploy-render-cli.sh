#!/bin/bash

echo "üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Render —á–µ—Ä–µ–∑ CLI"
echo "============================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
echo "üîê –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é..."
if ! render whoami > /dev/null 2>&1; then
    echo "‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ Render. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: render login"
    exit 1
fi

echo "‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ Render"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞..."
python3 check-render-readiness.py

if [ $? -ne 0 ]; then
    echo "‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é"
    exit 1
fi

# –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üì§ –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub..."
git add .
git commit -m "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è Render –¥–µ–ø–ª–æ—è $(date)"
git push origin main

echo "‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ GitHub!"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã..."
EXISTING_SERVICES=$(render services --output json | jq -r '.[].service.name')

if echo "$EXISTING_SERVICES" | grep -q "aeon_admin_hr"; then
    echo "‚ö†Ô∏è  –°–µ—Ä–≤–∏—Å aeon_admin_hr —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    echo "üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:"
    echo "1. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ dashboard.render.com"
    echo "2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Blueprint —Å render.yaml"
    echo ""
    echo "–ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å –≤—Ä—É—á–Ω—É—é:"
    echo "- –ò–∑–º–µ–Ω–∏—Ç—å build command –Ω–∞: ./build.sh"
    echo "- –ò–∑–º–µ–Ω–∏—Ç—å start command –Ω–∞: ./start.sh"
    echo "- –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
else
    echo "‚úÖ –ì–æ—Ç–æ–≤ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤"
fi

echo ""
echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo ""
echo "–í–∞—Ä–∏–∞–Ω—Ç 1 - –ß–µ—Ä–µ–∑ Dashboard (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):"
echo "1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://dashboard.render.com"
echo "2. –ù–∞–∂–º–∏—Ç–µ 'New +' ‚Üí 'Blueprint'"
echo "3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/antonver/aeon_admin_hr.git"
echo "4. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª render.yaml"
echo "5. –ù–∞–∂–º–∏—Ç–µ 'Apply'"
echo ""
echo "–í–∞—Ä–∏–∞–Ω—Ç 2 - –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å:"
echo "1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://dashboard.render.com/web/srv-d272anh5pdvs73c1hdpg"
echo "2. –í —Ä–∞–∑–¥–µ–ª–µ 'Settings' –æ–±–Ω–æ–≤–∏—Ç–µ:"
echo "   - Build Command: ./build.sh"
echo "   - Start Command: ./start.sh"
echo "3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo "4. –ù–∞–∂–º–∏—Ç–µ 'Save Changes'"
echo ""
echo "üîß –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:"
echo "- BOT_TOKEN (—Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞)"
echo ""
echo "üìñ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: RENDER_DEPLOYMENT.md" 