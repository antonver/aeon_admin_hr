#!/bin/bash

echo "๐ ะะฑะฝะพะฒะปัะตะผ ััะฐัะธัะตัะบะธะต ัะฐะนะปั ััะพะฝัะตะฝะดะฐ..."

# ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ััะพะฝัะตะฝะดะฐ
cd frontend

# ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ ะตัะปะธ ะฝัะถะฝะพ
if [ ! -d "node_modules" ]; then
    echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ..."
    npm install
fi

# ะกะพะฑะธัะฐะตะผ ััะพะฝัะตะฝะด
echo "๐๏ธ  ะกะพะฑะธัะฐะตะผ React ะฟัะธะปะพะถะตะฝะธะต..."
npm run build

# ะะพะทะฒัะฐัะฐะตะผัั ะฒ ะบะพัะฝะตะฒัั ะดะธัะตะบัะพัะธั
cd ..

# ะัะธัะฐะตะผ ััะฐััะต ััะฐัะธัะตัะบะธะต ัะฐะนะปั
echo "๐งน ะัะธัะฐะตะผ ััะฐััะต ัะฐะนะปั..."
rm -rf backend/static/*

# ะะพะฟะธััะตะผ ะฝะพะฒัะต ัะฐะนะปั
echo "๐ ะะพะฟะธััะตะผ ะฝะพะฒัะต ััะฐัะธัะตัะบะธะต ัะฐะนะปั..."
cp -r frontend/build/* backend/static/

# ะัะฟัะฐะฒะปัะตะผ ััััะบัััั ะฟะฐะฟะพะบ - ะฟะตัะตะผะตัะฐะตะผ ัะฐะนะปั ะธะท static/static/ ะฒ static/
if [ -d "backend/static/static" ]; then
    echo "๐ง ะัะฟัะฐะฒะปัะตะผ ััััะบัััั ะฟะฐะฟะพะบ..."
    mv backend/static/static/* backend/static/
    rmdir backend/static/static
    echo "โ ะกัััะบัััะฐ ะฟะฐะฟะพะบ ะธัะฟัะฐะฒะปะตะฝะฐ"
fi

echo "โ ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั ะพะฑะฝะพะฒะปะตะฝั!"
echo "๐ ะคะฐะนะปั ะฒ ะฟัะฐะฒะธะปัะฝัั ะดะธัะตะบัะพัะธัั:"
ls -la backend/static/js/ 2>/dev/null && echo "โ JS ัะฐะนะปั ะฒ backend/static/js/" || echo "โ JS ัะฐะนะปั ะฝะต ะฝะฐะนะดะตะฝั"
ls -la backend/static/css/ 2>/dev/null && echo "โ CSS ัะฐะนะปั ะฒ backend/static/css/" || echo "โ CSS ัะฐะนะปั ะฝะต ะฝะฐะนะดะตะฝั"

echo "๐ ะะพัะพะฒะพ ะบ ะดะตะฟะปะพั ะฝะฐ Render!" 